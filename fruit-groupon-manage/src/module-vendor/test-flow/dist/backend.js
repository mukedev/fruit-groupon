(()=>{var e={129:e=>{e.exports=e=>({})},169:e=>{function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw s}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t,n,r,o,a,s){try{var i=e[a](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,a){var s=e.apply(t,n);function i(e){r(s,o,a,i,c,"next",e)}function c(e){r(s,o,a,i,c,"throw",e)}i(void 0)}))}}e.exports=e=>{class n extends e.meta.AtomBase{async create(e){var t=()=>super.create,n=this;return o(regeneratorRuntime.mark((function r(){var o,a,s,i,c,d;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.atomClass,a=e.item,s=e.options,i=e.user,r.next=3,t().call(n,{atomClass:o,item:a,options:s,user:i});case 3:return c=r.sent,r.next=6,n.ctx.model.product.insert({atomId:c.atomId});case 6:return d=r.sent,r.abrupt("return",{atomId:c.atomId,itemId:d.insertId});case 8:case"end":return r.stop()}}),r)})))()}async read(e){var t=()=>super.read,n=this;return o(regeneratorRuntime.mark((function r(){var o,a,s,i,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.atomClass,a=e.options,s=e.key,i=e.user,r.next=3,t().call(n,{atomClass:o,options:a,key:s,user:i});case 3:if(c=r.sent){r.next=6;break}return r.abrupt("return",null);case 6:return n._getMeta(c),r.abrupt("return",c);case 8:case"end":return r.stop()}}),r)})))()}async select(e){var n=()=>super.select,r=this;return o(regeneratorRuntime.mark((function o(){var a,s,i,c,d,u,l;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return a=e.atomClass,s=e.options,i=e.items,c=e.user,o.next=3,n().call(r,{atomClass:a,options:s,items:i,user:c});case 3:d=t(i);try{for(d.s();!(u=d.n()).done;)l=u.value,r._getMeta(l)}catch(e){d.e(e)}finally{d.f()}case 5:case"end":return o.stop()}}),o)})))()}async write(e){var t=()=>super.write,n=this;return o(regeneratorRuntime.mark((function r(){var o,a,s,i,c,d,u;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.atomClass,a=e.target,s=e.key,i=e.item,c=e.options,d=e.user,r.next=3,t().call(n,{atomClass:o,target:a,key:s,item:i,options:c,user:d});case 3:return r.next=5,n.ctx.model.product.prepareData(i);case 5:return(u=r.sent).id=s.itemId,r.next=9,n.ctx.model.product.update(u);case 9:case"end":return r.stop()}}),r)})))()}async delete(e){var t=()=>super.delete,n=this;return o(regeneratorRuntime.mark((function r(){var o,a,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.atomClass,a=e.key,s=e.user,r.next=3,t().call(n,{atomClass:o,key:a,user:s});case 3:return r.next=5,n.ctx.model.product.delete({id:a.itemId});case 5:case"end":return r.stop()}}),r)})))()}_getMeta(e){const t=this._ensureItemMeta(e),n=(e.productPrice/100).toFixed(2);t.flags.push(n),t.summary=e.productCode}}return n}},434:e=>{function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw s}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t,n,r,o,a,s){try{var i=e[a](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,a){var s=e.apply(t,n);function i(e){r(s,o,a,i,c,"next",e)}function c(e){r(s,o,a,i,c,"throw",e)}i(void 0)}))}}e.exports=e=>{class n extends e.meta.AtomBase{async create(e){var t=()=>super.create,n=this;return o(regeneratorRuntime.mark((function r(){var o,a,s,i,c,d;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.atomClass,a=e.item,s=e.options,i=e.user,r.next=3,t().call(n,{atomClass:o,item:a,options:s,user:i});case 3:return c=r.sent,r.next=6,n.ctx.model.purchaseOrder.insert({atomId:c.atomId});case 6:return d=r.sent,r.abrupt("return",{atomId:c.atomId,itemId:d.insertId});case 8:case"end":return r.stop()}}),r)})))()}async read(e){var t=()=>super.read,n=this;return o(regeneratorRuntime.mark((function r(){var o,a,s,i,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.atomClass,a=e.options,s=e.key,i=e.user,r.next=3,t().call(n,{atomClass:o,options:a,key:s,user:i});case 3:if(c=r.sent){r.next=6;break}return r.abrupt("return",null);case 6:return n._getMeta(c),r.abrupt("return",c);case 8:case"end":return r.stop()}}),r)})))()}async select(e){var n=()=>super.select,r=this;return o(regeneratorRuntime.mark((function o(){var a,s,i,c,d,u,l;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return a=e.atomClass,s=e.options,i=e.items,c=e.user,o.next=3,n().call(r,{atomClass:a,options:s,items:i,user:c});case 3:d=t(i);try{for(d.s();!(u=d.n()).done;)l=u.value,r._getMeta(l)}catch(e){d.e(e)}finally{d.f()}case 5:case"end":return o.stop()}}),o)})))()}async write(e){var t=()=>super.write,n=this;return o(regeneratorRuntime.mark((function r(){var o,a,s,i,c,d,u,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.atomClass,a=e.target,s=e.key,i=e.item,c=e.options,d=e.user,r.next=3,t().call(n,{atomClass:o,target:a,key:s,item:i,options:c,user:d});case 3:return r.next=5,n.ctx.model.purchaseOrder.prepareData(i);case 5:return(u=r.sent).id=s.itemId,r.next=9,n.ctx.bean.detail.select({atomKey:s,pageForce:!1});case 9:return l=r.sent,u.detailsCount=l.length,u.detailsAmount=l.reduce(((e,t)=>e+t.amount),0),r.next=14,n.ctx.model.purchaseOrder.update(u);case 14:case"end":return r.stop()}}),r)})))()}async delete(e){var t=()=>super.delete,n=this;return o(regeneratorRuntime.mark((function r(){var o,a,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.atomClass,a=e.key,s=e.user,r.next=3,t().call(n,{atomClass:o,key:a,user:s});case 3:return r.next=5,n.ctx.model.purchaseOrder.delete({id:a.itemId});case 5:case"end":return r.stop()}}),r)})))()}_getMeta(e){const t=this._ensureItemMeta(e);e.detailsCount>0&&t.flags.push(e.detailsCount);const n=(e.detailsAmount/100).toFixed(2);t.flags.push(n),t.summary=e.description}}return n}},624:e=>{function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw s}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t,n,r,o,a,s){try{var i=e[a](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,a){var s=e.apply(t,n);function i(e){r(s,o,a,i,c,"next",e)}function c(e){r(s,o,a,i,c,"throw",e)}i(void 0)}))}}e.exports=e=>{class n extends e.meta.DetailBase{async create(e){var t=()=>super.create,n=this;return o(regeneratorRuntime.mark((function r(){var o,a,s,i,c,d;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.atomKey,a=e.detailClass,s=e.item,i=e.user,r.next=3,t().call(n,{atomKey:o,detailClass:a,item:s,user:i});case 3:return c=r.sent,r.next=6,n.ctx.model.purchaseOrderDetail.insert({atomId:o.atomId,detailId:c.detailId});case 6:return d=r.sent,r.abrupt("return",{detailId:c.detailId,detailItemId:d.insertId});case 8:case"end":return r.stop()}}),r)})))()}async read(e){var t=()=>super.read,n=this;return o(regeneratorRuntime.mark((function r(){var o,a,s,i,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.detailClass,a=e.options,s=e.key,i=e.user,r.next=3,t().call(n,{detailClass:o,options:a,key:s,user:i});case 3:if(c=r.sent){r.next=6;break}return r.abrupt("return",null);case 6:return n._getMeta(c),r.abrupt("return",c);case 8:case"end":return r.stop()}}),r)})))()}async select(e){var n=()=>super.select,r=this;return o(regeneratorRuntime.mark((function o(){var a,s,i,c,d,u,l,m;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return a=e.atomKey,s=e.detailClass,i=e.options,c=e.items,d=e.user,o.next=3,n().call(r,{atomKey:a,detailClass:s,options:i,items:c,user:d});case 3:u=t(c);try{for(u.s();!(l=u.n()).done;)m=l.value,r._getMeta(m)}catch(e){u.e(e)}finally{u.f()}case 5:case"end":return o.stop()}}),o)})))()}async write(e){var t=()=>super.write,n=this;return o(regeneratorRuntime.mark((function r(){var o,a,s,i,c,d,u;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.detailClass,a=e.target,s=e.key,i=e.item,c=e.options,d=e.user,r.next=3,t().call(n,{detailClass:o,target:a,key:s,item:i,options:c,user:d});case 3:return r.next=5,n.ctx.model.purchaseOrderDetail.prepareData(i);case 5:return(u=r.sent).id=s.detailItemId,u.amount=u.price*u.quantity,r.next=10,n.ctx.model.purchaseOrderDetail.update(u);case 10:case"end":return r.stop()}}),r)})))()}async delete(e){var t=()=>super.delete,n=this;return o(regeneratorRuntime.mark((function r(){var o,a,s,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.detailClass,a=e.target,s=e.key,i=e.user,r.next=3,t().call(n,{detailClass:o,target:a,key:s,user:i});case 3:return r.next=5,n.ctx.model.purchaseOrderDetail.delete({id:s.detailItemId});case 5:case"end":return r.stop()}}),r)})))()}_getMeta(e){const t=this._ensureItemMeta(e);e.quantity>1&&t.flags.push(e.quantity);const n=(e.amount/100).toFixed(2);t.flags.push(n),t.summary=e.detailCode}}return n}},758:e=>{function t(e,t,n,r,o,a,s){try{var i=e[a](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}e.exports=e=>{class n extends e.app.meta.FlowServiceBase{async execute(n){return(r=regeneratorRuntime.mark((function t(){var r,o,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.parameter,o=r.flowDefId,a=r.parameter,s=r.node,t.next=3,e.bean.flow.startById({flowDefId:o,flowVars:a,flowUserId:1,startEventId:s.id});case 3:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(o,a){var s=r.apply(e,n);function i(e){t(s,o,a,i,c,"next",e)}function c(e){t(s,o,a,i,c,"throw",e)}i(void 0)}))})();var r}}return n}},428:e=>{function t(e,t,n,r,o,a,s){try{var i=e[a](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}e.exports=e=>{class n extends e.app.meta.FlowServiceBase{async execute(e){return(n=regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.parameter,e.contextNode.vars.set("echo",n),t.abrupt("return",n);case 3:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(o,a){var s=n.apply(e,r);function i(e){t(s,o,a,i,c,"next",e)}function c(e){t(s,o,a,i,c,"throw",e)}i(void 0)}))})();var n}}return n}},223:e=>{function t(e,t,n,r,o,a,s){try{var i=e[a](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(o,a){var s=e.apply(n,r);function i(e){t(s,o,a,i,c,"next",e)}function c(e){t(s,o,a,i,c,"throw",e)}i(void 0)}))}}e.exports=e=>{class t extends e.meta.BeanBase{async update(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(1!==e.version){n.next=4;break}return r="\n          CREATE TABLE testFlowPurchaseOrder (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            description varchar(255) DEFAULT NULL,\n            _flowDefKey varchar(255) DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        ",n.next=4,t.ctx.model.query(r);case 4:if(2!==e.version){n.next=14;break}return r="\n          CREATE TABLE testFlowProduct (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            productCode varchar(50) DEFAULT NULL,\n            productPrice int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        ",n.next=8,t.ctx.model.query(r);case 8:return r="\n          CREATE TABLE testFlowPurchaseOrderDetail (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            detailId int(11) DEFAULT '0',\n            price int(11) DEFAULT '0',\n            quantity int(11) DEFAULT '0',\n            amount int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        ",n.next=11,t.ctx.model.query(r);case 11:return r="\n          ALTER TABLE testFlowPurchaseOrder\n            ADD COLUMN detailsCount int(11) DEFAULT '0',\n            ADD COLUMN detailsAmount int(11) DEFAULT '0'\n        ",n.next=14,t.ctx.model.query(r);case 14:case"end":return n.stop()}}),n)})))()}async init(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(1!==e.version){n.next=4;break}return r=[{roleName:"authenticated",action:"create"},{roleName:"authenticated",action:"read",scopeNames:0},{roleName:"authenticated",action:"write",scopeNames:0},{roleName:"authenticated",action:"delete",scopeNames:0},{roleName:"authenticated",action:"clone",scopeNames:0},{roleName:"authenticated",action:"deleteBulk"},{roleName:"authenticated",action:"exportBulk"},{roleName:"system",action:"read",scopeNames:"authenticated"}],n.next=4,t.ctx.bean.role.addRoleRightBatch({atomClassName:"purchaseOrder",roleRights:r});case 4:if(2!==e.version){n.next=8;break}return r=[{roleName:"authenticated",action:"create"},{roleName:"authenticated",action:"read",scopeNames:0},{roleName:"authenticated",action:"write",scopeNames:0},{roleName:"authenticated",action:"delete",scopeNames:0},{roleName:"authenticated",action:"clone",scopeNames:0},{roleName:"authenticated",action:"deleteBulk"},{roleName:"authenticated",action:"exportBulk"},{roleName:"system",action:"read",scopeNames:"authenticated"}],n.next=8,t.ctx.bean.role.addRoleRightBatch({atomClassName:"product",roleRights:r});case 8:case"end":return n.stop()}}),n)})))()}async test(){return n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}}return t}},313:(e,t,n)=>{const r=n(223),o=n(434),a=n(169),s=n(624),i=n(428),c=n(758);e.exports=e=>({"version.manager":{mode:"app",bean:r},"atom.purchaseOrder":{mode:"app",bean:o},"atom.product":{mode:"app",bean:a},"detail.purchaseOrder":{mode:"app",bean:s},"flow.service.test":{title:"Test",mode:"ctx",bean:i},"flow.service.startEventTimer":{title:"StartTestFlow",mode:"ctx",bean:c}})},817:e=>{e.exports=e=>({})},971:e=>{e.exports={}},724:e=>{e.exports={StartTestFlow:"Start Test Flow"}},995:e=>{e.exports={Product:"产品","Create Product":"新建产品","Product List":"产品列表","Purchase Order":"采购订单","Create Purchase Order":"新建采购订单","Purchase Order List":"采购订单列表","Product Code Exists":"产品编码已存在","WorkFlow Test":"工作流测试",Test_Set00_Simple:"测试_分组00_简单流程",StartTestFlow:"启动测试工作流"}},266:(e,t,n)=>{e.exports={"en-us":n(724),"zh-cn":n(995)}},796:e=>{e.exports=e=>({atomName:"Test_Set00_Activity_None",atomStaticKey:"set00_activityNone",atomRevision:0,description:"",content:JSON.stringify({process:{nodes:[{id:"startEvent_1",name:"Start",type:"startEventNone"},{id:"activity_1",name:"ActivityNone",type:"activityNone"},{id:"endEvent_1",name:"End",type:"endEventNone"}],edges:[{id:"edge_1",source:"startEvent_1",target:"activity_1"},{id:"edge_2",source:"activity_1",target:"endEvent_1"}]}})})},172:(e,t,n)=>{const r=n(295);e.exports=e=>{const t=e.meta.mockUtil.parseInfoFromPackage(__dirname),n={listener:r,process:{nodes:[{id:"startEvent_1",name:"Start",type:"startEventNone"},{id:"activity_1",name:"ActivityService",type:"activityService",options:{bean:{module:t.relativeName,name:"test"},parameterExpression:"context.vars.get(`echo`)"}},{id:"activity_2",name:"ActivityNone",type:"activityNone"},{id:"endEvent_1",name:"End",type:"endEventNone"}],edges:[{id:"edge_1",source:"startEvent_1",target:"activity_1"},{id:"edge_2",source:"activity_1",target:"activity_2"},{id:"edge_3",source:"activity_2",target:"endEvent_1"}]}};return{atomName:"Test_Set00_Activity_Service",atomStaticKey:"set00_activityService",atomRevision:0,description:"",content:JSON.stringify(n)}}},771:(e,t,n)=>{const r=n(770);e.exports=e=>{const t={listener:r,process:{nodes:[{id:"startEvent_1",name:"Start",type:"startEventNone"},{id:"endEvent_1",name:"End",type:"endEventNone"},{id:"endEvent_2",name:"End",type:"endEventNone"}],edges:[{id:"edge_1",name:"x=1",source:"startEvent_1",target:"endEvent_1",options:{conditionExpression:"context.vars.get('x')===1"}},{id:"edge_2",name:"x=2",source:"startEvent_1",target:"endEvent_2",options:{conditionExpression:"\n              contextNode.vars.get('x')===2\n            "}}]}};return{atomName:"Test_Set00_Edge_Sequence",atomStaticKey:"set00_edgeSequence",atomRevision:1,description:"",content:JSON.stringify(t)}}},332:(e,t,n)=>{const r=n(526);e.exports=e=>{const t={listener:r,process:{nodes:[{id:"startEvent_1",name:"Start",type:"startEventNone"},{id:"endEvent_1",name:"End",type:"endEventNone"}],edges:[{id:"edge_1",source:"startEvent_1",target:"endEvent_1"}]}};return{atomName:"Test_Set00_Simple",atomStaticKey:"set00_simple",atomRevision:0,description:"",content:JSON.stringify(t)}}},630:e=>{e.exports=e=>{const t={listener:null,process:{nodes:[{id:"startEvent_1",name:"Drafting",type:"startEventAtom",options:{atom:{module:e.meta.mockUtil.parseInfoFromPackage(__dirname).relativeName,atomClassName:"purchaseOrder"},conditionExpression:"atom._flowDefKey==='set01_atomAssigneesConfirmation'"}},{id:"activity_1",name:"Review",type:"activityUserTask",options:{assignees:{roles:"family"},confirmation:!0,bidding:!0,allowForward:!0,allowSubstitute:!0}},{id:"endEvent_1",name:"End",type:"endEventAtom"}],edges:[{id:"edge_1",source:"startEvent_1",target:"activity_1"},{id:"edge_2",source:"activity_1",target:"endEvent_1"}]}};return{atomName:"Test_Set01_Atom_AssigneesConfirmation",atomStaticKey:"set01_atomAssigneesConfirmation",atomRevision:1,description:"",content:JSON.stringify(t)}}},227:(e,t,n)=>{const r=n(12);e.exports=e=>{const t=e.meta.mockUtil.parseInfoFromPackage(__dirname),n={listener:r,process:{nodes:[{id:"startEvent_1",name:"Drafting",type:"startEventAtom",options:{atom:{module:t.relativeName,atomClassName:"purchaseOrder"},conditionExpression:"atom._flowDefKey==='set01_atomUserTask'"}},{id:"activity_1",name:"Review",type:"activityUserTask",options:{assignees:{vars:"flowUser"},confirmation:!1,bidding:!1,completionCondition:{},allowForward:!0,allowSubstitute:!0,schema:{write:["atomName",{name:"description",property:{type:"string",ebType:"text",ebTitle:"Description"}}]}}},{id:"endEvent_1",name:"End",type:"endEventAtom"}],edges:[{id:"edge_1",source:"startEvent_1",target:"activity_1"},{id:"edge_2",source:"activity_1",target:"endEvent_1"}]}};return{atomName:"Test_Set01_Atom_UserTask",atomStaticKey:"set01_atomUserTask",atomRevision:1,description:"",content:JSON.stringify(n)}}},280:(e,t,n)=>{const r=n(463);e.exports=e=>{const t=e.meta.mockUtil.parseInfoFromPackage(__dirname),n={listener:r,process:{nodes:[{id:"startEvent_1",name:"Drafting",type:"startEventAtom",options:{atom:{module:t.relativeName,atomClassName:"purchaseOrder"},conditionExpression:"atom._flowDefKey==='set01_startEventAtom'"}},{id:"activity_1",name:"ActivityNone",type:"activityNone"},{id:"endEvent_1",name:"End",type:"endEventAtom"}],edges:[{id:"edge_1",source:"startEvent_1",target:"activity_1"},{id:"edge_2",source:"activity_1",target:"endEvent_1"}]}};return{atomName:"Test_Set01_StartEvent_Atom",atomStaticKey:"set01_startEventAtom",atomRevision:0,description:"",content:JSON.stringify(n)}}},878:e=>{e.exports=e=>{const t={listener:null,process:{nodes:[{id:"startEvent_1",name:"Drafting",type:"startEventAtom",options:{atom:{module:e.meta.mockUtil.parseInfoFromPackage(__dirname).relativeName,atomClassName:"purchaseOrder"},conditionExpression:"atom._flowDefKey==='set02_behaviorOvertime'"}},{id:"activity_1",name:"Review",type:"activityUserTask",options:{assignees:{vars:"flowUser"}},behaviors:[{id:"behavior_1",name:"Overtime",type:"overtime",color:"#FF3B30",options:{cancelActivity:!0,timeDuration:3e3}}]},{id:"endEvent_1",name:"End",type:"endEventAtom"}],edges:[{id:"edge_1",source:"startEvent_1",target:"activity_1"},{id:"edge_2",source:"activity_1",target:"endEvent_1"},{id:"edge_3",source:"activity_1",target:"startEvent_1",behavior:"behavior_1"}]}};return{atomName:"Test_Set02_BehaviorOvertime",atomStaticKey:"set02_behaviorOvertime",atomRevision:1,description:"",content:JSON.stringify(t)}}},238:(e,t,n)=>{const r=n(332),o=n(771),a=n(796),s=n(172),i=n(280),c=n(227),d=n(630),u=n(878);e.exports=e=>[r(e),o(e),a(e),s(e),i(e),c(e),d(e),u(e)]},584:e=>{e.exports=e=>[{atomName:"Apple",atomStaticKey:"apple",atomRevision:0,productCode:"test-001",productPrice:1200},{atomName:"Pear",atomStaticKey:"pear",atomRevision:0,productCode:"test-002",productPrice:1e3},{atomName:"Banana",atomStaticKey:"banana",atomRevision:0,productCode:"test-003",productPrice:1300}]},1:e=>{e.exports=e=>{const t=e.meta.mockUtil.parseInfoFromPackage(__dirname);return[{atomName:"Create Purchase Order",atomStaticKey:"createPurchaseOrder",atomRevision:0,atomCategoryId:"a-base:menu.Create",resourceType:"a-base:menu",resourceConfig:JSON.stringify({module:t.relativeName,atomClassName:"purchaseOrder",atomAction:"create"}),resourceRoles:"authenticated"},{atomName:"Purchase Order List",atomStaticKey:"listPurchaseOrder",atomRevision:0,atomCategoryId:"a-base:menu.List",resourceType:"a-base:menu",resourceConfig:JSON.stringify({module:t.relativeName,atomClassName:"purchaseOrder",atomAction:"read"}),resourceRoles:"authenticated"},{atomName:"Create Product",atomStaticKey:"createProduct",atomRevision:0,atomCategoryId:"a-base:menu.Create",resourceType:"a-base:menu",resourceConfig:JSON.stringify({module:t.relativeName,atomClassName:"product",atomAction:"create"}),resourceRoles:"authenticated"},{atomName:"Product List",atomStaticKey:"listProduct",atomRevision:0,atomCategoryId:"a-base:menu.List",resourceType:"a-base:menu",resourceConfig:JSON.stringify({module:t.relativeName,atomClassName:"product",atomAction:"read"}),resourceRoles:"authenticated"}]}},623:e=>{function t(e,t,n,r,o,a,s){try{var i=e[a](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}e.exports=e=>{const n={};return n.productCode={async:!0,type:"string",errors:!0,compile:function(){return function(){var n,r=(n=regeneratorRuntime.mark((function t(n){var r,o,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return",!0);case 2:if((r=this).meta&&r.meta.validateHost){t.next=5;break}return t.abrupt("return",!0);case 5:return o=r.meta.validateHost.key.atomId,t.next=8,r.model.queryOne("\n          select a.id from aAtom a\n            left join testFlowProduct b on a.id=b.atomId\n              where a.atomStage=0 and a.iid=? and a.deleted=0 and b.productCode=?\n          ",[r.instance.id,n]);case 8:if(!(a=t.sent)||a.id===o){t.next=12;break}throw s=[{keyword:"x-productCode",params:[],message:r.text("Product Code Exists")}],new e.meta.ajv.ValidationError(s);case 12:return t.abrupt("return",!0);case 13:case"end":return t.stop()}}),t,this)})),function(){var e=this,r=arguments;return new Promise((function(o,a){var s=n.apply(e,r);function i(e){t(s,o,a,i,c,"next",e)}function c(e){t(s,o,a,i,c,"throw",e)}i(void 0)}))});return function(e){return r.apply(this,arguments)}}()}},n}},908:e=>{e.exports=e=>({product:{type:"object",properties:{atomName:{type:"string",ebType:"text",ebTitle:"Product Name",notEmpty:!0},productCode:{type:"string",ebType:"text",ebTitle:"Product Code",notEmpty:!0,"x-productCode":!0},productPrice:{type:"number",ebType:"text",ebTitle:"Product Price",ebParams:{currency:!0}}}},productSearch:{type:"object",properties:{productCode:{type:"string",ebType:"text",ebTitle:"Product Code"}}}})},261:e=>{e.exports=e=>{const t=e.meta.mockUtil.parseInfoFromPackage(__dirname),n={};return n.purchaseOrder={type:"object",properties:{__groupBasicInfo:{ebType:"group-flatten",ebTitle:"Basic Info"},atomName:{type:"string",ebType:"text",ebTitle:"Name",notEmpty:!0},description:{type:"string",ebType:"text",ebTitle:"Description"},_flowDefKey:{type:"string",ebType:"select",ebTitle:"Flow Definition",ebOptionsBlankAuto:!0,ebOptions:[{title:"Test_Set01_StartEvent_Atom",value:"set01_startEventAtom"},{title:"Test_Set01_Atom_UserTask",value:"set01_atomUserTask"},{title:"Test_Set01_Atom_AssigneesConfirmation",value:"set01_atomAssigneesConfirmation"}],notEmpty:!0},__groupStats:{ebType:"group-flatten",ebTitle:"Details Stats"},detailsCount:{type:"number",ebType:"detailsStat",ebTitle:"Quantity",ebParams:{detailClass:{module:t.relativeName,detailClassName:"default"},expression:"details.length"},ebReadOnly:!0},detailsAmount:{type:"number",ebType:"detailsStat",ebTitle:"Amount",ebParams:{detailClass:{module:t.relativeName,detailClassName:"default"},expression:"details.reduce(function(a,b){return a+b.amount;},0)",currency:!0},ebAutoSubmit:!0,ebReadOnly:!0},__groupDetails:{ebType:"group-flatten",ebTitle:"Details",ebGroupWhole:!0,ebParams:{titleHidden:!0}},details:{ebType:"details",ebTitle:"Details",ebParams:{detailClass:{module:t.relativeName,detailClassName:"default"}},ebDisplay:{expression:"!!_flowDefKey",dependencies:["_flowDefKey"]}}}},n.purchaseOrderSearch={type:"object",properties:{description:{type:"string",ebType:"text",ebTitle:"Description"}}},n}},809:e=>{e.exports=e=>{const t={},n={expression:"!!detailCodeId",dependencies:["detailCodeId"]};return t.purchaseOrderDetail={type:"object",properties:{detailCodeId:{type:"number"},detailCode:{type:"string",ebType:"atom",ebTitle:"Product Code",ebParams:{target:"_self",atomClass:{module:"test-flow",atomClassName:"product"},selectOptions:{},atomId:"detailCodeId",mapper:{detailCodeId:"atomId",detailCode:"productCode",detailName:"atomName",price:"productPrice"}},notEmpty:!0},detailName:{type:"string",ebType:"text",ebTitle:"Product Name",notEmpty:!0,ebDisplay:n},price:{type:"number",ebType:"text",ebTitle:"Price",ebParams:{currency:!0},ebDisplay:n},quantity:{type:"number",ebType:"text",ebTitle:"Quantity",ebDisplay:n},amount:{type:"number",ebType:"text",ebTitle:"Amount",ebComputed:{expression:"price * quantity",dependencies:"price,quantity"},ebParams:{currency:!0},ebReadOnly:!0,ebDisplay:n}}},t}},326:(e,t,n)=>{const r=n(908),o=n(261),a=n(809);e.exports=e=>{const t={};return Object.assign(t,r(e)),Object.assign(t,o(e)),Object.assign(t,a(e)),t}},712:e=>{function t(e,t,n,r,o,a,s){try{var i=e[a](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}e.exports=e=>{class n extends e.Controller{async start(){var e,n=this;return(e=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.ctx.bean.flow.startByKey({flowDefKey:n.ctx.request.body.flowDefKey,flowVars:n.ctx.request.body.flowVars,flowUserId:n.ctx.state.user.op.id});case 2:t=e.sent,n.ctx.success({flowId:t.context._flowId});case 4:case"end":return e.stop()}}),e)})),function(){var n=this,r=arguments;return new Promise((function(o,a){var s=e.apply(n,r);function i(e){t(s,o,a,i,c,"next",e)}function c(e){t(s,o,a,i,c,"throw",e)}i(void 0)}))})()}}return n}},691:(e,t,n)=>{const r=n(712);e.exports=e=>({flow:r})},312:(e,t,n)=>{const r=n(817),o=n(266),a=n(971);e.exports=e=>{const t=n(129)(e),s=n(313)(e),i=n(788)(e),c=n(691)(e),d=n(481)(e),u=n(700)(e),l=n(730)(e);return{aops:t,beans:s,routes:i,controllers:c,services:d,models:u,config:r,locales:o,errors:a,meta:l}}},730:(e,t,n)=>{const r=n(638)("extend2");e.exports=e=>{const t={},o=n(623)(e),a=n(326)(e),s=n(238)(e),i=n(1)(e),c=n(584)(e);return r(!0,t,{base:{atoms:{purchaseOrder:{info:{bean:"purchaseOrder",title:"Purchase Order",tableName:"testFlowPurchaseOrder",details:["default"]},actions:{},validator:"purchaseOrder",search:{validator:"purchaseOrderSearch"}},product:{info:{bean:"product",title:"Product",tableName:"testFlowProduct"},actions:{},validator:"product",search:{validator:"productSearch"}}},statics:{"a-flow.flowDef":{items:s},"a-base.resource":{items:i},"test-flow.product":{items:c}}},detail:{details:{default:{info:{bean:"purchaseOrder",title:"Details",tableName:"testFlowPurchaseOrderDetail"},actions:{},validator:"purchaseOrderDetail"}}},validation:{validators:{purchaseOrder:{schemas:"purchaseOrder"},purchaseOrderSearch:{schemas:"purchaseOrderSearch"},product:{schemas:"product"},productSearch:{schemas:"productSearch"},purchaseOrderDetail:{schemas:"purchaseOrderDetail"}},keywords:{"x-productCode":o.productCode},schemas:a},index:{indexes:{testFlowProduct:"createdAt,updatedAt,atomId,productCode",testFlowPurchaseOrder:"createdAt,updatedAt,atomId",testFlowPurchaseOrderDetail:"createdAt,updatedAt,atomId,detailId"}}}),t}},54:e=>{e.exports=e=>{class t extends e.meta.Model{constructor(e){super(e,{table:"testFlowProduct",options:{disableDeleted:!1}})}}return t}},503:e=>{e.exports=e=>{class t extends e.meta.Model{constructor(e){super(e,{table:"testFlowPurchaseOrder",options:{disableDeleted:!1}})}}return t}},65:e=>{e.exports=e=>{class t extends e.meta.Model{constructor(e){super(e,{table:"testFlowPurchaseOrderDetail",options:{disableDeleted:!1}})}}return t}},700:(e,t,n)=>{const r=n(54),o=n(503),a=n(65);e.exports=e=>({product:r,purchaseOrder:o,purchaseOrderDetail:a})},788:e=>{e.exports=e=>{let t=[];return t=t.concat([{method:"post",path:"flow/start",controller:"flow",middlewares:"test"}]),t}},481:e=>{e.exports=e=>({})},295:e=>{e.exports="\nclass Listener {\n  constructor(context) {\n    this.context = context;\n  }\n\n  async onNodeBegin(contextNode) {\n    if (contextNode._nodeDef.id === 'activity_1') {\n      this.context.vars.set('echo', 'hello');\n    }\n  }\n\n  async onNodeDoing(contextNode) {\n    if (contextNode._nodeDef.id === 'activity_2') {\n      // execute activity service\n      const res = await contextNode.utils.executeService({\n        bean: {\n          module: 'test-flow',\n          name: 'test',\n        },\n        parameter: 'hello world',\n      });\n      assert.equal(res, 'hello world');\n    }\n  }\n\n  async onNodeEnd(contextNode) {\n    if (contextNode._nodeDef.id === 'activity_1') {\n      const echo = contextNode.vars.get('echo');\n      assert.equal(echo, 'hello');\n    }\n  }\n}\n"},770:e=>{e.exports="\nclass Listener {\n  constructor(context) {\n    this.context = context;\n  }\n\n  async onNodeEnter(contextNode) {\n    const x = this.context.vars.get('x');\n    if (contextNode._nodeDef.id === 'startEvent_1') {\n      // nodeVars\n      contextNode.vars.set('x', x);\n    }\n    if (contextNode._nodeDef.id === 'endEvent_1') {\n      // assert\n      assert.equal(x, '1');\n    }\n    if (contextNode._nodeDef.id === 'endEvent_2') {\n      // assert\n      assert.equal(x, '2');\n    }\n  }\n}\n"},526:e=>{e.exports="\nclass Listener {\n  constructor(context) {\n    this.context = context;\n  }\n\n  async onFlowStart(options) {\n    console.log('onFlowStart: ', options.startEventId);\n    // flowVars\n    const xyz = this.context.vars.get('x.y.z');\n    assert.equal(xyz, undefined);\n    this.context.vars.set('x.y.z', 'flow');\n  }\n\n  async onFlowEnd(options) {\n    console.log('onFlowEnd: ', options && options.flowRemark);\n    // flowVars\n    const xyz = this.context.vars.get('x.y.z');\n    assert.equal(xyz, 'flow');\n  }\n\n  async onNodeEnter(contextNode) {\n    console.log('onNodeEnter: ', contextNode._nodeDef.id);\n    // nodeVars\n    const xyz = contextNode.vars.get('x.y.z');\n    assert.equal(xyz, undefined);\n    contextNode.vars.set('x.y.z', contextNode._nodeDef.id);\n  }\n\n  async onNodeBegin(contextNode) {\n    console.log('onNodeBegin: ', contextNode._nodeDef.id);\n  }\n\n  async onNodeDoing(contextNode) {\n    console.log('onNodeDoing: ', contextNode._nodeDef.id);\n  }\n\n  async onNodeEnd(contextNode) {\n    console.log('onNodeEnd: ', contextNode._nodeDef.id);\n  }\n\n  async onNodeLeave(contextNode) {\n    console.log('onNodeLeave: ', contextNode._nodeDef.id);\n    // nodeVars\n    const xyz = contextNode.vars.get('x.y.z');\n    assert.equal(xyz, contextNode._nodeDef.id);\n  }\n\n  async onEdgeEnter(contextEdge, contextNode) {\n    console.log('onEdgeEnter: ', contextEdge._edgeDef.id, ' from node: ', contextNode._nodeDef.id);\n  }\n\n  async onEdgeTake(contextEdge, contextNode) {\n    console.log('onEdgeTake: ', contextEdge._edgeDef.id, ' from node: ', contextNode._nodeDef.id);\n  }\n\n  async onEdgeLeave(contextEdge, contextNode) {\n    console.log('onEdgeLeave: ', contextEdge._edgeDef.id, ' from node: ', contextNode._nodeDef.id);\n  }\n\n  getNodeDefOptions(contextNode /* { options }*/) {\n    console.log('getNodeDefOptions: ', contextNode._nodeDef.id);\n  }\n}\n"},12:e=>{e.exports="\nclass Listener {\n  constructor(context) {\n    this.context = context;\n  }\n\n  async onNodeEnter(contextNode) {\n    if (contextNode._nodeDef.id === 'startEvent_1') {\n      const _flowDefKey = this.context.atom._flowDefKey;\n      assert.equal(_flowDefKey, 'set01_atomUserTask');\n    }\n  }\n\n  async onTaskCreated(contextTask, contextNode) {\n    console.log('onTaskCreated: ', contextTask._flowTaskId, ' of node: ', contextNode._nodeDef.id);\n  }\n\n  async onTaskClaimed(contextTask, contextNode) {\n    console.log('onTaskClaimed: ', contextTask._flowTaskId, ' of node: ', contextNode._nodeDef.id);\n  }\n\n  async onTaskCompleted(contextTask, contextNode) {\n    console.log('onTaskCompleted: ', contextTask._flowTaskId, ' of node: ', contextNode._nodeDef.id);\n    console.log(\n      'handleStatus: %d, handleRemark: %s',\n      contextTask._flowTask.handleStatus,\n      contextTask._flowTask.handleRemark\n    );\n  }\n\n  async getSchemaRead(contextTask, contextNode /* { schemaBase, schema }*/) {\n    console.log('getSchemaRead: ', contextTask._flowTaskId, ' of node: ', contextNode._nodeDef.id);\n  }\n\n  async getSchemaWrite(contextTask, contextNode /* { schemaBase, schema }*/) {\n    console.log('getSchemaWrite: ', contextTask._flowTaskId, ' of node: ', contextNode._nodeDef.id);\n  }\n\n  getNodeDefOptions(contextNode /* { options }*/) {\n    console.log('getNodeDefOptions: ', contextNode._nodeDef.id);\n  }\n}\n"},463:e=>{e.exports="\nclass Listener {\n  constructor(context) {\n    this.context = context;\n  }\n\n  async onNodeEnter(contextNode) {\n    if (contextNode._nodeDef.id === 'startEvent_1') {\n      const _flowDefKey = this.context.atom._flowDefKey;\n      assert.equal(_flowDefKey, 'set01_startEventAtom');\n    }\n  }\n}\n"},638:e=>{"use strict";e.exports=require("require3")}},t={},n=function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}(312);module.exports=n})();